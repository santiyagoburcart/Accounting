{% extends 'dashboard/base.html' %}
{% load i18n %}

{% block title %}{% trans "Customers Management" %}{% endblock %}
{% block page_title %}{% trans "Customers Management" %}{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <div class="lg:col-span-1">
        <div class="glass-card p-6 sticky top-6">
            <h2 class="text-lg font-bold text-[var(--text-main)] mb-4 flex items-center gap-2"><i data-feather="user-plus" class="text-purple-500"></i> {% trans "Add New Customer" %}</h2>
            <form method="post" class="space-y-4">{% csrf_token %}{% for field in form %}<div><label class="block text-sm text-[var(--text-muted)] mb-1">{{ field.label }}</label>{{ field }}{% if field.errors %}<p class="text-red-400 text-xs mt-1">{{ field.errors.0 }}</p>{% endif %}</div>{% endfor %}<button type="submit" class="w-full py-2.5 rounded-xl bg-purple-600 hover:bg-purple-700 text-white font-bold transition-colors">{% trans "Save Customer" %}</button></form>
        </div>
    </div>

    <div class="lg:col-span-2">
        <div class="glass-card p-6">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-xl font-bold text-[var(--text-main)]">{% trans "Customer List" %}</h2>
                <form method="get" class="w-full sm:w-1/2 relative"><input type="text" name="q" value="{{ request.GET.q }}" placeholder="{% trans "Search customers..." %}" class="form-input pl-10"><i data-feather="search" class="absolute left-3 top-3 w-4 h-4 text-[var(--text-muted)]"></i></form>
            </div>
            <div class="overflow-x-auto">
                <table class="custom-table w-full text-sm">
                    <thead><tr><th>{% trans "Name" %}</th><th>{% trans "Phone" %}</th><th>{% trans "Referrer" %}</th><th>{% trans "Actions" %}</th></tr></thead>
                    <tbody>
                        {% for customer in customers %}
                        {% if not request.GET.q or request.GET.q|lower in customer.name|lower %}
                        <tr>
                            <td class="font-bold">{{ customer.name }}</td><td class="text-[var(--text-muted)]">{{ customer.phone_number|default:"-" }}</td><td>{{ customer.referred_by.name|default:"-" }}</td>
                            <td>
                                <div class="flex items-center gap-2">
                                    <a href="{% url 'dashboard:edit_customer_profile' customer.pk %}" class="text-blue-400 hover:text-blue-500"><i data-feather="edit-2" class="w-4 h-4"></i></a>
                                    <button type="button" class="text-red-400 hover:text-red-500" data-url="{% url 'dashboard:delete_customer_profile' customer.pk %}" data-name="{{ customer.name }}" onclick="openDeleteModal(this)"><i data-feather="trash-2" class="w-4 h-4"></i></button>
                                </div>
                            </td>
                        </tr>
                        {% endif %}
                        {% empty %}<tr><td colspan="4" class="text-center p-4">{% trans "No customers found." %}</td></tr>{% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_scripts %}<script>$(document).ready(function(){$('select').select2({theme:"classic",width:'100%',dir:document.documentElement.dir});});</script>{% endblock %}