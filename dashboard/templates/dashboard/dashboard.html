{% extends 'dashboard/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§ØµÙ„ÛŒ{% endblock %}

{% block content %}
    <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
        <div>
            <h1 class="text-3xl font-bold text-white mb-2">Ø³Ù„Ø§Ù…ØŒ {{ user.first_name|default:user.username }} ğŸ‘‹</h1>
            <p class="text-[var(--text-muted)]">Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ. Ø¨ÛŒØ²Ù†Ø³ Ø±Ùˆ Ø¨ØªØ±Ú©ÙˆÙ†!</p>
        </div>
        <div class="text-sm text-[var(--text-muted)] bg-[var(--bg-sidebar)] px-4 py-2 rounded-full border border-[var(--border-color)]">
            ğŸ“… Ø§Ù…Ø±ÙˆØ²: <span id="current-date-display"></span>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
        <div class="glass-card p-6 relative overflow-hidden group">
            <div class="absolute -right-4 -top-4 w-24 h-24 bg-purple-500/10 rounded-full blur-2xl group-hover:bg-purple-500/20 transition-all"></div>
            <div class="flex items-center justify-between mb-4">
                <div class="p-3 bg-purple-500/20 rounded-xl text-purple-400">
                    <i data-feather="database"></i>
                </div>
                <span class="text-xs font-bold text-green-400 flex items-center gap-1">
                    +12% <i data-feather="trending-up" class="w-3 h-3"></i>
                </span>
            </div>
            <h3 class="text-[var(--text-muted)] text-sm font-medium mb-1">Ø­Ø¬Ù… ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯Ù‡</h3>
            <p class="text-3xl font-black text-white">{{ total_giga }} <span class="text-sm font-normal text-gray-500">Ú¯ÛŒÚ¯</span></p>
        </div>

        <div class="glass-card p-6 relative overflow-hidden group">
            <div class="absolute -right-4 -top-4 w-24 h-24 bg-blue-500/10 rounded-full blur-2xl group-hover:bg-blue-500/20 transition-all"></div>
            <div class="flex items-center justify-between mb-4">
                <div class="p-3 bg-blue-500/20 rounded-xl text-blue-400">
                    <i data-feather="dollar-sign"></i>
                </div>
            </div>
            <h3 class="text-[var(--text-muted)] text-sm font-medium mb-1">Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</h3>
            <p class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">{{ total_revenue|intcomma }} <span class="text-sm font-normal text-gray-500">ØªÙˆÙ…Ø§Ù†</span></p>
        </div>

        <div class="glass-card p-6 relative overflow-hidden group">
            <div class="absolute -right-4 -top-4 w-24 h-24 bg-emerald-500/10 rounded-full blur-2xl group-hover:bg-emerald-500/20 transition-all"></div>
            <div class="flex items-center justify-between mb-4">
                <div class="p-3 bg-emerald-500/20 rounded-xl text-emerald-400">
                    <i data-feather="check-circle"></i>
                </div>
            </div>
            <h3 class="text-[var(--text-muted)] text-sm font-medium mb-1">Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡</h3>
            <p class="text-3xl font-black text-white">{{ paid_amount|intcomma }} <span class="text-sm font-normal text-gray-500">ØªÙˆÙ…Ø§Ù†</span></p>
        </div>

        <div class="glass-card p-6 relative overflow-hidden group">
            <div class="absolute -right-4 -top-4 w-24 h-24 bg-rose-500/10 rounded-full blur-2xl group-hover:bg-rose-500/20 transition-all"></div>
            <div class="flex items-center justify-between mb-4">
                <div class="p-3 bg-rose-500/20 rounded-xl text-rose-400">
                    <i data-feather="alert-circle"></i>
                </div>
            </div>
            <h3 class="text-[var(--text-muted)] text-sm font-medium mb-1">Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø¯Ù‡ÛŒ</h3>
            <p class="text-3xl font-black text-rose-400">{{ unpaid_amount|intcomma }} <span class="text-sm font-normal text-gray-500">ØªÙˆÙ…Ø§Ù†</span></p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-1">
            <div class="glass-card p-6 sticky top-6">
                <div class="flex items-center gap-3 mb-6 border-b border-[var(--border-color)] pb-4">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white shadow-lg shadow-purple-500/30">
                        <i data-feather="user-plus" class="w-5 h-5"></i>
                    </div>
                    <h2 class="text-xl font-bold text-white">Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</h2>
                </div>
                
                <form method="post" class="space-y-5">
                    {% csrf_token %}
                    {% for field in form %}
                    <div class="form-group">
                        <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-[var(--text-secondary)] mb-2">
                            {{ field.label }}
                        </label>
                        {{ field }} {% if field.errors %}
                            <p class="text-red-400 text-xs mt-1">{{ field.errors.0 }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                    
                    <button type="submit" class="btn-primary w-full mt-6 flex items-center justify-center gap-2 group">
                        <span>Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø´ØªØ±ÛŒ</span>
                        <i data-feather="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
                    </button>
                </form>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div class="glass-card p-6 min-h-[500px]">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <i data-feather="list" class="text-[var(--primary)]"></i>
                        Ù„ÛŒØ³Øª Ù…Ø´ØªØ±ÛŒØ§Ù† Ø§Ø®ÛŒØ±
                    </h2>
                    
                    <form method="get" class="w-full sm:w-48">
                        <select name="month" class="form-select text-sm" onchange="this.form.submit()">
                            <option value="">Ù‡Ù…Ù‡ Ù…Ø§Ù‡â€ŒÙ‡Ø§</option>
                            {% for month_num, month_name in months.items %}
                                <option value="{{ month_num }}" {% if selected_month == month_num|stringformat:"s" %}selected{% endif %}>{{ month_name }}</option>
                            {% endfor %}
                        </select>
                    </form>
                </div>

                <div class="overflow-x-auto">
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</th>
                                <th class="hidden md:table-cell">ØªØ§Ø±ÛŒØ® Ø³Ø±Ø±Ø³ÛŒØ¯</th>
                                <th>ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for customer in customers %}
                            <tr>
                                <td>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-white">{{ customer.name }}</span>
                                        <span class="text-xs text-[var(--text-muted)] md:hidden">{{ customer.phone_number }}</span>
                                    </div>
                                </td>
                                <td class="hidden md:table-cell text-sm text-[var(--text-muted)]">
                                    {{ customer.expire_date|date:"Y/m/d"|default:"-" }}
                                </td>
                                <td class="text-sm">
                                    {{ customer.jalali_payment_date }}
                                </td>
                                <td>
                                    {% if customer.is_paid %}
                                        <span class="status-badge status-paid">Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</span>
                                    {% else %}
                                        <span class="status-badge status-unpaid">Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø´Ø¯Ù‡</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="flex items-center gap-3 justify-end">
                                        <a href="{% url 'dashboard:edit_customer_profile' pk=customer.pk %}" class="text-[var(--primary)] hover:text-white transition-colors p-2 hover:bg-[var(--primary)] rounded-lg">
                                            <i data-feather="edit-2" class="w-4 h-4"></i>
                                        </a>
                                        </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-10 text-[var(--text-muted)]">
                                    <div class="flex flex-col items-center gap-4">
                                        <div class="w-16 h-16 bg-[var(--bg-body)] rounded-full flex items-center justify-center">
                                            <i data-feather="inbox" class="w-8 h-8 opacity-50"></i>
                                        </div>
                                        <p>Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!</p>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ Ø´Ù…Ø³ÛŒ (Ø¨Ù‡ ØµÙˆØ±Øª Ø³Ø§Ø¯Ù‡ Ø¨Ø§ JS)
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ ÙØ¹Ù„Ø§ Ø§Ø² ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒÚ©Ù†Ù…ØŒ Ø§Ú¯Ø± datepicker ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ù‡ Ù…ÛŒØ´Ù‡ Ø´Ù…Ø³ÛŒ Ú©Ø±Ø¯
    // Ø¯Ø± ÙØ§Ø² Ø¨Ø¹Ø¯ÛŒ Ø§ÛŒÙ†Ùˆ Ú©Ø§Ù…Ù„Ø§ Ø´Ù…Ø³ÛŒ Ù…ÛŒÚ©Ù†ÛŒÙ…
    document.getElementById('current-date-display').innerText = new Date().toLocaleDateString('fa-IR', options);
</script>
{% endblock %}